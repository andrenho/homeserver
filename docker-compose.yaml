version: '3.9'
services:
  dns:
    build: dns
    restart: always
    image: dns:latest
    volumes:
      - type: bind
        source: ./dns/conf
        target: /etc/dnsmasq.d
    ports:
      - "53:53"
      - "53:53/udp"
    dns: 192.168.15.1

  hello:
    build: hello
    restart: always
    image: hello:latest
    ports:
      - "8080:80"

  proxy:
    build: proxy
    restart: always
    volumes:
      - type: bind
        source: ./proxy/cert
        target: /etc/ssl
    image: proxy:latest
    ports:
      - "80:80"
      - "443:443"

  dynamicdns:
    build: dynamicdns
    restart: always
    image: dynamicdns:latest
    secrets:
      - source: aws_credentials
        target: /root/.aws/credentials

#  homer:
#    restart: always
#    image: b4bz/homer:latest
#    volumes:
#      - type: bind
#        source: ./dns/conf
#        target: /www/asssets
#    ports:
#      - "8080:8080"

secrets:
  aws_credentials:
    file: /home/andre/.aws/credentials
